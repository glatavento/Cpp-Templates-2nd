
\documentclass[11pt, onecolumn, oneside]{ctexbook}

\usepackage{xpatch}
\usepackage{subfiles,graphicx,enumitem}
\usepackage{tabularx,booktabs}
\usepackage{hyperref,url}
\usepackage{minted}

\usepackage[a5paper, scale=0.8]{geometry}
\usepackage[most]{tcolorbox}

\title{C++ Templates 2nd Edition} 
\author{David Vandevoorde \and Nicolai M. Josuttis \and Douglas Gregor \and 陈晓伟}
\date{\today}

\ExplSyntaxOn

% Remove newpage after \part
\xpatchcmd { \@endpart } {\vfil\newpage} {} {} {}
\xpatchcmd { \@endpart } {\newpage     } {} {} {}

% Setup fonts
\setCJKmainfont { HYXuanSong } [ BoldFont=HYXuanSong~75S, ItalicFont=FZNewKai-Z03 ]
\setmainfont { Libertinus~Serif }
\setsansfont { Libertinus~Sans  }
\setmonofont { Iosevka~Slab     }

% Setup hyperlinks
\hypersetup { breaklinks=true } 

% Setup enumerate, itemize and description
\setenumerate  { nosep }
\setitemize    { nosep }
\setdescription{ nosep }

% Setup minted
\setminted { obeytabs, tabsize=2, breaklines=true, fontsize=\footnotesize, frame=single }

% Def \filename
\NewDocumentCommand { \filename } { m } 
{ \noindent \textit { #1 } \nopagebreak[4] }

% Def cpp environment
\NewDocumentEnvironment { cpp } { }
{ \VerbatimEnvironment
  \begin { minted } [ linenos=true ] { cpp } } 
{ \end   { minted } }

% Def shell environment
\NewDocumentEnvironment { shell } { }
{ \VerbatimEnvironment
  \begin { minted } { text } } 
{ \end   { minted } }

\NewDocumentEnvironment { notice } { }
{ \begin { tcolorbox } [ colback = green!5!white, colframe=green!75!black ] } 
{ \end   { tcolorbox } }

\ExplSyntaxOff

\begin{document}
    \frontmatter
    \setcounter{secnumdepth}{0}

	\subfile{frontmatter/titlepage.tex}
	\subfile{frontmatter/preface.tex}
	\subfile{frontmatter/Acknowledgments-for-the-Second.tex}
	\subfile{frontmatter/Acknowledgments-for-the-First.tex}
	\subfile{frontmatter/About-This-Book.tex}
	
	\phantomsection
	\addcontentsline{toc}{chapter}{目录}
	\tableofcontents

    \mainmatter
    \setcounter{secnumdepth}{2}

	\subfile{content/part1.tex}
	\subfile{content/part2.tex}
	\subfile{content/part3.tex}
	
	\appendix
	\subfile{backmatter/Appendix.tex}
	
	\backmatter
	\subfile{backmatter/Bibliography.tex}
	\subfile{backmatter/Glossary.tex}

\end{document}

